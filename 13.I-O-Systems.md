# Chapter 13: I/O Systems

## Overview

One of the primary functions of an operating system is to manage the I/O devices of a computer. The I/O system is a major factor in the overall performance of the system, and thus it is important to understand how it works.

## I/O Hardware

Computers operate a great variety of I/O devices. These devices can be broadly classified into three categories:
1.  **Storage devices:** Disks, tapes, etc.
2.  **Transmission devices:** Network cards, modems, etc.
3.  **Human-interface devices:** Keyboards, mice, monitors, etc.

A device communicates with the computer system by sending signals over a cable or through the air. The device communicates with the machine via a connection point, or **port**. A **bus** is a set of wires and a rigidly defined protocol that specifies a set of messages that can be sent on the wires.

A **controller** is a collection of electronics that can operate a port, a bus, or a device. A controller has one or more registers for data and control signals.

### Polling

One way for the host to communicate with a controller is through **polling**. The host repeatedly reads the busy bit from the controller until it becomes clear. The host then sets the command-ready bit and writes a command into the command register.

### Interrupts

The CPU hardware has a wire called the interrupt-request line that the CPU senses after executing every instruction. When the CPU detects that a controller has asserted a signal on the interrupt-request line, the CPU saves its current state and jumps to the interrupt-handler routine at a fixed address in memory.

### Direct Memory Access (DMA)

For a device that does large transfers, such as a disk drive, it is inefficient to have the CPU handle the transfer of data one byte at a time. Instead, a **Direct Memory Access (DMA)** controller is used. The DMA controller transfers blocks of data from buffer storage directly to main memory without CPU intervention.

## Application I/O Interface

The I/O system call interface is the set of system calls that provide access to the I/O system. The I/O system must provide a consistent interface to the applications, regardless of the underlying hardware.

The I/O system is typically organized as a layered structure.
-   **Device Drivers:** Each device has a device driver that understands the device-specific language.
-   **Device-Independent I/O Software:** This layer provides a uniform interface to the device drivers.
-   **User-Space I/O Software:** This layer consists of libraries that provide a simplified interface to the I/O system calls.

## Kernel I/O Subsystem

The kernel I/O subsystem is responsible for a number of services:
-   **I/O Scheduling:** The kernel is responsible for scheduling the I/O requests.
-   **Buffering:** A buffer is a memory area that stores data while they are being transferred between two devices or between a device and an application.
-   **Caching:** A cache is a region of fast memory that holds copies of data.
-   **Spooling:** A spool is a buffer that holds output for a device, such as a printer, that cannot accept interleaved data streams.
-   **Error Handling:** The I/O system must be able to handle errors.
-   **I/O Protection:** The I/O system must protect the devices from unauthorized access.

## Transforming I/O Requests to Hardware Operations

An application's I/O request is transformed into a set of hardware operations. For example, a request to read a file is transformed into a set of disk I/O operations.

## STREAMS

A **stream** is a full-duplex connection between a device driver and a user-level process. It consists of a stream head, which interfaces with the user process, a driver end, which controls the device, and zero or more stream modules between them.

## Performance

The I/O system is a major factor in the overall performance of a computer system. The performance of the I/O system can be improved by:
-   Reducing the number of context switches.
-   Reducing the number of times that data must be copied.
-   Using large transfers, reducing the frequency of interrupts.
-   Using DMA.
-   Balancing the load on the CPU, memory, and I/O devices.
